<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <meta property="og:title" content="Thaalam Radio Station" />
    <meta property="og:description" content="No:1 Tamil radio station in Switzerland" />
    <meta property="og:image" content="https://www.thaalam.ch/img/thalam-logo.png" />

    <!-- CSS -->

    <!-- <link rel="stylesheet" href="css/bootstrap.min.css" /> -->
    <link rel="stylesheet" href="css/theme-css.css" />
    <link rel="stylesheet" href="css/bootstrap-reboot.min.css" />
    <link rel="stylesheet" href="css/bootstrap-grid.min.css" />
    <link rel="stylesheet" href="css/owl.carousel.min.css" />
    <link rel="stylesheet" href="css/magnific-popup.css" />
    <link rel="stylesheet" href="css/select2.min.css" />
    <link rel="stylesheet" href="css/plyr.css" />
    <link rel="stylesheet" href="css/icomoon.css" />

    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/popup.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" />
    <script>
        const customEvent = new CustomEvent("myCustomEvent", {
            detail: {
                message: "Custom event triggered!",
            },
        });
    </script>
    <script src="js/jquery-3.5.1.min.js"></script>
    <script src="js/creote-extension.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" />
    <!-- Favicons -->
    <link rel="icon" type="image/png" href="icon/favicon.png" sizes="32x32" />
    <title>Thaalam - AR Rahman live-in Concert</title>
    <meta name="robots" content="noindex" />
    <style>
        .select2-container {
            width: 100% !important;
            background: #ffffff;
            padding: 10px;
            border: 1px solid;
        }

        .mfp-iframe-holder .mfp-content {
            height: 100% !important;
        }

        .mfp-container {
            padding: 40px 15px !important;
        }

        a {
            text-decoration: none;
        }
    </style>


    <!-- Google Tag Manager -->
    <script>(function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-KLC938NV');</script>
    <!-- End Google Tag Manager -->


</head>

<body style="background: url('img/background.jpg'); background-size: cover">

    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KLC938NV" height="0" width="0"
            style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <!-- header -->
    <!-- header -->
    <header class="header">
        <div class="header__content">
            <div class="header__logo">
                <a href="./">
                    <img src="img/thalam-logo.png" alt="" />
                </a>
            </div>

            <div id="commonnavbar" style="margin-right: 10px; text-align: end"></div>

            <div class="commonnavbar6" id="commonnavbar6" style="text-align: end; margin-left: auto; margin-right: 8px">
            </div>
            <script></script>

            <!-- <div id="commonnavbar2"  style="  text-align: end;"></div> -->

            <div class="header__action header__action--signin" style="width:55%; margin-right: 30px" id="commonnavbar3">
            </div>
            <!-- <div class="header__action-btn" style="width:75%;    margin-right: 35px;">
        <a class="header__action-btn" href="signin">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,2A10,10,0,0,0,4.65,18.76h0a10,10,0,0,0,14.7,0h0A10,10,0,0,0,12,2Zm0,18a8,8,0,0,1-5.55-2.25,6,6,0,0,1,11.1,0A8,8,0,0,1,12,20ZM10,10a2,2,0,1,1,2,2A2,2,0,0,1,10,10Zm8.91,6A8,8,0,0,0,15,12.62a4,4,0,1,0-6,0A8,8,0,0,0,5.09,16,7.92,7.92,0,0,1,4,12a8,8,0,0,1,16,0A7.92,7.92,0,0,1,18.91,16Z"></path></svg>
        </a>
      </div>
      <div id="commonnavbar3"></div> -->

            <a href="./contact">
                <div class="phone-number phone-number--below">
                    <img class="fa" src="icon/phone.png" />
                    <span style="color: #f60001">Reach Us</span> <br />
                    <span style="font-weight: initial">+41 79 288 22 71</span>
                </div>
            </a>
            <button class="header__btn" type="button">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>
    <!-- end header -->
    <!-- end sidebar -->
    <!-- sidebar -->
    <div class="sidebar" style="background: url('img/background.jpg'); background-size: cover">
        <!-- sidebar logo -->
        <div class="sidebar__logo">
            <a href="./"><img src="img/thalam-logo.png" alt="" /></a>
        </div>
        <!-- end sidebar logo -->

        <!-- sidebar nav -->
        <ul class="sidebar__nav" id="menucontent1"></ul>
        <!-- end sidebar nav -->
    </div>
    <!-- end sidebar -->

    <!-- main content -->
    <main class="main">
        <div class="container-fluid">
            <div class="row row--grid">
                <!-- breadcrumb -->
                <div class="col-12">
                    <ul class="breadcrumb">
                        <li class="breadcrumb__item"><a href="index.html">Home</a></li>
                        <li class="breadcrumb__item breadcrumb__item--active">
                            Packages
                        </li>
                    </ul>
                </div>
                <!-- end breadcrumb -->
            </div>
            <div class="row row--grid">
                <!-- title -->
                <div class="col-12">
                    <div class=" ">
                        <h1 style="text-align: center">Join Our Thaalam Family</h1>

                        <!--===============spacing==============-->
                        <div class="pd_bottom_10"></div>
                        <!--===============spacing==============-->
                    </div>
                </div>
                <!-- end title -->
            </div>
            <!-- <div class="d-flex" id="blogcontent" style="display: contents !important;"></div> -->
            <section id="info-utile" class="bg-white">
                <div class="container">
                    <div class="row default_row">
                        <div class="full_width_box">
                            <!--===============spacing==============-->
                            <!--===============spacing==============-->
                            <div class="row">
                                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                    <section class="faq_section type_two">
                                        <div class="block_faq">
                                            <div class="package-toggle text-center mb-4">
                                                <div class="billing-toggle">
                                                    <button id="monthlyBtn" class="toggle-btn active"
                                                        onclick="setBillingDuration('monthly')">Monthly</button>
                                                    <button id="yearlyBtn" class="toggle-btn "
                                                        onclick="setBillingDuration('yearly')">Yearly</button>

                                                </div>
                                            </div>
                                            <div class="accordion">
                                                <dl id="subscribefaq"></dl>
                                            </div>
                                        </div>
                                    </section>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>
    <!-- end main content -->

    <!-- footer -->
    <div id="commonfooter"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/select2.min.js"></script>
    <script src="js/jquery.inputmask.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/swiper.min.js"></script>
    <script src="js/plyr.min.js"></script>
    <script src="js/main.js"></script>
    <script src="js/menu.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="https://js.stripe.com/v3/"></script>

    <script>
        var items = [];
        window.onload = function () {
            getPackage();
        };
        $(function () {
            $("#commonheader").load("./header");
            $("#commonfooter").load("./footer");

            menucontent();
            setTimeout(() => {
                SetLogin1();
                SetLogout();
                // SetUsername();
            }, 1000);
        });

        let selectedDuration = 'monthly';

        function setBillingDuration(duration) {
            selectedDuration = duration;

            document.getElementById("yearlyBtn").classList.remove("active");
            document.getElementById("monthlyBtn").classList.remove("active");

            if (duration === "yearly") {
                document.getElementById("yearlyBtn").classList.add("active");
            } else {
                document.getElementById("monthlyBtn").classList.add("active");
            }

            getPackage();
        }

        function getPackage() {
            const token = localStorage.getItem('token') || "";
            const login = token !== "" ? "1" : "0";

            const queryParams = new URLSearchParams({
                page: 1,
                limit: 20,
                status: "active"
            });

            fetch(`https://api.demoview.ch/api/package?${queryParams.toString()}`)
                .then((res) => res.json())
                .then((response) => {
                    items = response.data || [];

                    let subscribestr = "";
                    items.forEach((x, index) => {
                        let featuresstr = "";
                        x.features.forEach(y => {
                            featuresstr += `<li class="green">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M18.71,7.21a1,1,0,0,0-1.42,0L9.84,14.67,6.71,11.53A1,1,0,1,0,5.29,13l3.84,3.84a1,1,0,0,0,1.42,0l8.16-8.16A1,1,0,0,0,18.71,7.21Z" />
                        </svg>
                        ${y}
                    </li>`;
                        });

                        // Build price block based on selected duration
                        let priceHTML = "";
                        if (selectedDuration === "yearly" && x.yearly_price) {
                            priceHTML = `
                            <h6 class="plan__title">
                                    <del style="color: #888;">${x.symbol || "CHF "}${(x.price * 12).toFixed(2)}</del>
                                    ${x.symbol || "CHF "}${(x.yearly_price).toFixed(2)} / User / applied annually
                            </h6>`;
                        } else {
                            priceHTML = `
                        <h6 class="plan__title">
                            ${x.symbol || "CHF "}${(x.price).toFixed(2)} / User / month
                        </h6>`;
                        }

                        subscribestr += `
                    <dt class="faq_header ${index === 0 ? "active" : ""}">
                        <div>
                            <h3 class="plan__price" style="margin-bottom: 10px">${x.package_name}</h3>
                            ${priceHTML}
                            <button class="toggle-btn active" style="max-width:120px"
                                onclick="${login === '1' ? `navigateToPaymentPage('${index}')` : 'navigateToNextPage()'}">
                                Buy Now
                            </button>
                        </div>
                        <span class="icon-arrow-down"><i class='bx bx-home-alt'></i></span>
                    </dt>
                    <dd class="accordion-content hide" ${index === 0 ? 'style="display: block"' : ""}>
                        <ul class="ms-3 plan__list">
                            ${featuresstr}
                        </ul>
                    </dd>
                `;
                    });

                    // Populate the HTML with the packages
                    document.getElementById("subscribefaq").innerHTML = subscribestr;

                    // Optional: Dispatch any custom events if needed
                    if (typeof customEvent !== "undefined") {
                        window.dispatchEvent(customEvent);
                    }
                })
                .catch((error) => {
                    console.error('Error fetching packages:', error);
                });
        }

        function navigateToNextPage() {
            // Replace 'next-page.html' with the URL of your next page
            window.location.href = 'signup';
        }

        async function navigateToPaymentPage(packageid) {
            const packageDetails = items[packageid];
            const memberId = localStorage.getItem("memberid");
            const token = localStorage.getItem("token");

            const isYearly = selectedDuration === "yearly";
            const unitPrice = isYearly ? packageDetails.yearly_price : packageDetails.price;
            const durationLabel = isYearly ? "per Year" : `per ${packageDetails.duration}`;
            const duration = selectedDuration === "yearly" ? "year" : "month";


            const result = await Swal.fire({
                title: `🎉 Subscribe to ${packageDetails.package_name}`,
                html: `
            <p style="font-size:16px; margin-bottom: 8px;">
                You're choosing the <strong>${packageDetails.package_name}</strong> plan.
            </p>
            <p style="font-size:16px;">
                <strong>CHF ${(unitPrice).toFixed(2)}</strong> / User / ${durationLabel}
            </p>
            <div style="margin-top: 20px; text-align: center;">
                <input type="checkbox" id="autoRenew" style="margin-right: 8px">
                <label for="autoRenew" style="font-size: 14px;">Enable Auto-Renewal</label>
                <p style="font-size:12px; color:#666; margin-top:6px;">
                   ⚠️ Auto-renewal is available <strong>only with Card payments</strong>. Twint is not supported for recurring subscriptions.
                 </p>
             </div>   
        `,
                showCancelButton: true,
                confirmButtonText: "🔥 Yes, Pay Now",
                cancelButtonText: "Maybe Later",
                customClass: {
                    confirmButton: 'swal2-confirm-custom',
                    cancelButton: 'swal2-cancel-custom'
                },
                buttonsStyling: false,
                preConfirm: () => {
                    return {
                        autoRenew: document.getElementById('autoRenew').checked
                    };
                }
            });



            if (result.isConfirmed) {
                try {
                    const paymentIntentRes = await fetch('https://api.demoview.ch/api/payments/initiate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            member_id: memberId,
                            package_id: packageDetails.id,
                            currency: "chf",
                            duration: duration,
                            auto_renew: result.value.autoRenew
                        })
                    });

                    const data = await paymentIntentRes.json();

                    if (data.success) {
                        window.location.href = data.session_url;
                    } else {
                        Swal.fire("Error", data.message || "Unable to initiate payment.", "error");
                    }
                }
                catch (error) {
                    console.error(error);
                    Swal.fire("Error", "An error occurred while initiating payment.", "error");
                }

            }
        }

        function openLink(link) {
            window.location.href = link;
        }
    </script>
</body>

</html>